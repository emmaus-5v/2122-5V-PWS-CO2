<!doctype html>
<html lang="nl">

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="style.css">
</head>

<body>

	</main>
	<h1>Actuele CO2 waarden op het Emmauscollege</h1>
	<!-- plattegrond -->
	<article>
		hier komt een plattegrond
	</article>
	<!-- webpages met CO2 waarden -->
	<iframe id="B27" src="B27.html"></iframe>
	<iframe id="B42" src="https://nl.wikipedia.org/wiki/Hoofdpagina"></iframe>

	<!-- voettekst -->
	<footer>
		<hr>
		<p>Het maken van deze website is een opdracht voor het vak informatica op het Emmauscollege Rotterdam.</p>
	</footer>

	<!-- new scripts -->
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
		</script>
	<script>
    
		(function () {
			// this code is being executed when page finished loading
			console.log("index.html: index.html geladen");   
		})();

    setTimeout(leesWaarden, 0); // na 500 ms de functie leesWaarden uitvoeren
    // LETOP: als de iframes nog niet geladen zijn na 500 ms dan gaat het fout
    
    function leesWaarden() {
      // Next trick thanx to
      // https://stackoverflow.com/questions/26630519/queryselector-for-web-elements-inside-iframe
      element = document.querySelector("#B27").contentWindow.document.querySelector("#CO2waarde")
      if(element != null) {
        console.log("index.html: CO2waarde B27=" + element.innerHTML);
      } 
      else {
        console.log("index.html: CO2waarde B27= nog niet geladen, nieuwe poging over 100 ms");
        setTimeout(leesWaarden, 100);
      };
    }

 
	</script>

	<!-- old scripts	
  <script> // functies om de producten te laden en tonen op de webpagina
    
    // deze functie wordt aangeroepen als de pagina geladen is
    // deze functie laadt de producten via de API
		(function() { 
        // your page initialization code here
        // the DOM will be available here
       
        // laad winkelmandje
        updateBasket()

        // laad producten
        // de functie showProducts wordt aangeroepen als er antwoord van de API is
        var request = new XMLHttpRequest()
        request.open('GET', '/api/products', true) 
        request.onload = showProducts 
        request.send() 

      })();

    // deze functie zet de producten op het scherm
    // nadat de API is aangeroepen
    function showProducts() {
      console.log("showProducts called")
      const template = document.querySelector('#productcard');
      const app = document.getElementById('index')
      
      const container = document.createElement('div')
      container.setAttribute('class', 'container row article-container')

      app.appendChild(container)
        
            var data = JSON.parse(this.response) // vertaal response van API naar array met producten
            for (let row in data) { // herhaal voor elke product
              const product = data[row]
              var name = product.name.substr(0, 35)
              if(name.length < product.name.length) {
                name = name + '...'
              }
              // voeg product toe aan DOM, 
              // zodat deze zichtbaar wordt op de webpagina
              const clone = template.content.cloneNode(true);
              clone.querySelector(".product_title").textContent = name
              clone.querySelector(".product_description").textContent =`${product.description.substr(0, 100)}...`
              clone.querySelector(".product_price").textContent = `â‚¬ ${product.price.toFixed(2)}`
              clone.querySelector(".product_code").textContent = product.code
              clone.querySelector(".product_id").value = product.id
              clone.querySelector(".product_id").dataset.json = JSON.stringify(product)
              clone.querySelector(".product_image").src =`/images/${product.id}.jpg`
              container.appendChild(clone)
            }
          }
	</script>
-->

</body>

</html>